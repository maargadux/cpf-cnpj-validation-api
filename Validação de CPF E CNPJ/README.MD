# üîê API de Valida√ß√£o de CPF e CNPJ

> Uma API simples, direta e **do mundo real**, feita pra validar CPF e CNPJ com seguran√ßa, controle de uso e mentalidade de produto.

Essa API n√£o nasceu pra ser s√≥ um exerc√≠cio. Ela foi pensada como **base de um SaaS**, com autentica√ß√£o por API Key, limite di√°rio, painel admin e tudo organizado do jeito certo.

---

## üöÄ O que essa API faz

* ‚úÖ Valida **CPF**
* ‚úÖ Valida **CNPJ**
* ‚úÖ Detecta automaticamente se √© CPF ou CNPJ
* üîê Protege endpoints com **API Key**
* üìä Controla **uso di√°rio por chave**
* üëÆ Tem endpoints **admin** pra gerenciar chaves

Tudo isso com FastAPI, SQLite e boas pr√°ticas.

---

## üß† Por que esse projeto existe?

Porque muita gente aprende API s√≥ com CRUD gen√©rico.
Aqui a ideia foi diferente:

> **pensar como produto**, n√£o s√≥ como c√≥digo.

Esse projeto simula uma API que poderia ser usada por:

* sistemas financeiros
* ERPs
* cadastros
* bots
* qualquer lugar que precise validar documento brasileiro

---

## üß± Tecnologias usadas

* **Python 3.11+**
* **FastAPI**
* **SQLite** (simples e suficiente pro caso)
* **Pydantic** (contratos de resposta)
* **Pytest** (testes)

---

## üìÅ Estrutura do projeto

```text
.
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ auth.py        # autentica√ß√£o por API Key + limite di√°rio
‚îÇ   ‚îú‚îÄ‚îÄ db.py          # banco de dados e schema
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ validators/
‚îÇ   ‚îú‚îÄ‚îÄ cpf.py         # regras de CPF
‚îÇ   ‚îú‚îÄ‚îÄ cnpj.py        # regras de CNPJ
‚îÇ   ‚îî‚îÄ‚îÄ document.py   # detecta CPF ou CNPJ
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ validation_response.py  # modelo de resposta da API
‚îÇ
‚îú‚îÄ‚îÄ main.py            # aplica√ß√£o FastAPI
‚îú‚îÄ‚îÄ database.db        # banco SQLite
‚îú‚îÄ‚îÄ .env               # vari√°veis de ambiente (n√£o versionar)
‚îî‚îÄ‚îÄ README.md
```

---

## üîê Autentica√ß√£o (API Key)

Essa API **n√£o funciona aberta**.
Tudo que valida documento exige uma **API Key**.

### Como funciona

* Um **admin** cria uma API Key
* A key tem:

  * plano (`free`, `pro`, etc)
  * limite di√°rio
* Cada request conta no uso di√°rio

---

## üëÆ Endpoints de Admin

### Criar uma API Key

`POST /admin/create-key`

Header:

```
X-Admin-Key: SUA_CHAVE_DE_ADMIN
```

Resposta:

```json
{
  "api_key": "chave-gerada-aqui",
  "plan": "free",
  "daily_limit": 100
}
```

> ‚ö†Ô∏è Guarde essa key. Ela s√≥ aparece uma vez.

---

### Listar API Keys (mascaradas)

`GET /me/keys`

Mostra todas as chaves, mas **sem vazar tudo**:

```
AB12CD...9X8Y
```

---

### Atualizar plano ou limite

`PATCH /admin/update-limit`

Par√¢metros:

* `key_prefix` (in√≠cio da key)
* `plan`
* `daily_limit`

---

### Deletar (revogar) uma key

`DELETE /admin/delete-key`

Par√¢metro:

* `key_prefix`

A key deixa de funcionar na hora.

---

## üìä Conta / Uso

### Ver uso di√°rio

`GET /me/usage`

Header:

```
X-API-Key: SUA_API_KEY
```

Resposta:

```json
{
  "plan": "free",
  "day": "2026-01-29",
  "used": 3,
  "daily_limit": 100,
  "remaining": 97
}
```

---

## ‚úÖ Valida√ß√£o de documentos

### CPF

`GET /validate/cpf?number=12345678909`

### CNPJ

`GET /validate/cnpj?number=11222333000181`

### Autom√°tico

`GET /validate/document?number=...`

Resposta padr√£o:

```json
{
  "type": "CPF",
  "input": "12345678909",
  "formatted": "123.456.789-09",
  "valid": true,
  "message": "CPF v√°lido"
}
```

---

## üß™ Testes

Os testes s√£o feitos com **pytest**.

Instala√ß√£o:

```bash
pip install pytest
```

Rodar testes:

```bash
pytest
```

---

## ‚ñ∂Ô∏è Como rodar o projeto

1. Clone o reposit√≥rio
2. Crie o `.env`

```env
ADMIN_KEY=sua-chave-de-admin
```

3. Ative a venv
4. Rode:

```bash
uvicorn main:app --reload
```

5. Acesse:

```
http://127.0.0.1:8000/docs
```

---

## üõ£Ô∏è Pr√≥ximos passos (roadmap)

* [ ] Hash de API keys no banco
* [ ] Rate limit por minuto
* [ ] Logs estruturados
* [ ] Deploy p√∫blico
* [ ] Versionamento da API (`/v1`)

---

## üß† Filosofia do projeto

C√≥digo limpo.
Sem firula.
Pensado pra funcionar no mundo real.

> Feito por algu√©m que t√° aprendendo, mas aprendendo **do jeito certo**.

---

## üñ§ Autoria

Feito por **Mali**.

Backend, API, mundo real e p√© no ch√£o.
